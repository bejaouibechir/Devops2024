


# ✅ 1. Démarche complète sans Helm


### 🔁 **Étape 0 : Préparation (pré-requis)**

- Un cluster Kubernetes fonctionnel (Minikube, Kubeadm, etc.)
- Accès à `kubectl`
- Tu veux utiliser un **Service NodePort**, donc pas besoin d’Ingress Controller.

---

### ⚙️ **Étape 1 : Déploiement sans Helm (à la main)**

#### 🧾 Fichier `deployment.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx
          ports:
            - containerPort: 80
```

#### 🧾 Fichier `service.yaml`
```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  type: NodePort
  selector:
    app: nginx
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30080
```

#### 🚀 Appliquer les fichiers :
```bash
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
```

#### 🌐 Accéder à l’app :
```bash
NODE_IP=$(kubectl get nodes -o jsonpath="{.items[0].status.addresses[0].address}")
echo "http://$NODE_IP:30080"
```

---

# ✅ 2.  Installation propre de Helm**

#### ✅ Installer Helm
```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

#### 🔍 Vérifier :
```bash
helm version
```

---

### 📦 Créer un Chart personnalisé avec Helm**

```bash
helm create nginx-chart
cd nginx-chart
```

---

### 🛠️ Modifier `values.yaml` (version simplifiée) :

```yaml
replicaCount: 1

image:
  repository: nginx
  pullPolicy: IfNotPresent
  tag: ""

service:
  type: NodePort
  port: 80
  nodePort: 30080

resources: {}

nodeSelector: {}
tolerations: []
affinity: {}

# Ne pas oublier d'enlever les templates correspondants si on n'utilise pas ces options
serviceAccount:
  create: false

ingress:
  enabled: false

autoscaling:
  enabled: false
```

---

### 🛠️ Modifier `templates/service.yaml` :

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ include "nginx-chart.fullname" . }}
spec:
  type: {{ .Values.service.type }}
  selector:
    app: {{ include "nginx-chart.name" . }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: 80
      nodePort: {{ .Values.service.nodePort }}
```

---

### 🛠️ Modifier `templates/deployment.yaml` :

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "nginx-chart.fullname" . }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "nginx-chart.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "nginx-chart.name" . }}
    spec:
      containers:
        - name: nginx
          image: "{{ .Values.image.repository }}{{ if .Values.image.tag }}:{{ .Values.image.tag }}{{ end }}"
          ports:
            - containerPort: 80
```

---

### 🚀 Étape 4 : Lancer le déploiement Helm

```bash
helm install my-nginx ./nginx-chart
```

---

### 🌍 Accéder à l’application

```bash
NODE_IP=$(kubectl get nodes -o jsonpath="{.items[0].status.addresses[0].address}")
echo "http://$NODE_IP:30080"
```

---

## 🧹 Nettoyage à tout moment

```bash
helm uninstall my-nginx
kubectl delete -f deployment.yaml -f service.yaml  # si tu veux nettoyer le déploiement manuel
```

---

Tu veux que je te fasse un `.zip` avec les bons fichiers (`values.yaml`, `templates`, etc.) pour que tu n’aies plus qu’à tester ?