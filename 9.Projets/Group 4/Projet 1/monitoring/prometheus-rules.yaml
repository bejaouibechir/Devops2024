apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: mysql-alerts
  namespace: monitoring
  labels:
    prometheus: kube-prometheus
    role: alert-rules
spec:
  groups:
  - name: mysql
    interval: 30s
    rules:
    - alert: MySQLDown
      expr: mysql_up == 0
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "MySQL instance is down"
        description: "MySQL instance {{ $labels.instance }} is down"
    
    - alert: MySQLTooManyConnections
      expr: mysql_global_status_threads_connected > 80
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: "MySQL has too many connections"
        description: "MySQL instance {{ $labels.instance }} has {{ $value }} connections"
    
    - alert: MySQLSlowQueries
      expr: rate(mysql_global_status_slow_queries[5m]) > 0.5
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "MySQL has slow queries"
        description: "MySQL instance {{ $labels.instance }} has {{ $value }} slow queries per second"
    
    - alert: MySQLInnoDBLogWaits
      expr: rate(mysql_global_status_innodb_log_waits[15m]) > 10
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "MySQL InnoDB log waits detected"
        description: "MySQL instance {{ $labels.instance }} has {{ $value }} InnoDB log waits per second"
    
    - alert: MySQLHighThreadsRunning
      expr: mysql_global_status_threads_running > 50
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "MySQL has high number of running threads"
        description: "MySQL instance {{ $labels.instance }} has {{ $value }} running threads"
