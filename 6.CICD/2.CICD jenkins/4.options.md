#  **`options` (d√©finir des comportements globaux : `timeout`, `timestamps`, `retry`)**

## Exemples d'options

### 1. **`disableConcurrentBuilds()`**
   Emp√™che l'ex√©cution simultan√©e de plusieurs instances du m√™me pipeline.

   **Sans cette option**, si un pipeline est en cours d‚Äôex√©cution et qu‚Äôun nouveau d√©clenchement se produit **(par un commit, un trigger automatique, ou manuel)**, Jenkins ***lance une nouvelle instance en parall√®le***.
üîπ Avec **disableConcurrentBuilds()**, si un build est d√©j√† en cours, ***les nouveaux d√©clenchements sont mis en attente*** jusqu'√† la fin du build en cours.

   ```groovy
   options {
       disableConcurrentBuilds()
   }
   ```

**Un exemple:**

``` groovy
pipeline {
    agent any
    options {
        disableConcurrentBuilds() // Emp√™che plusieurs ex√©cutions simultan√©es
    }
    stages {
        stage('Long Process') {
            steps {
                echo "D√©but du build..."
                sleep(10) // Simule un long traitement de 10 secondes
                echo "Fin du build."
            }
        }
    }
}
```

### 2. **`buildDiscarder()`**
   Permet de d√©finir une strat√©gie pour conserver les builds, comme la suppression automatique des anciens builds.

   ```groovy
   options {
       buildDiscarder(logRotator(numToKeepStr: '5'))
   }
   ```
   Ici, seuls les 5 derniers builds seront conserv√©s.

   **Un autre exemple:**
   ``` groovy
       pipeline {
    agent any
    options {
        buildDiscarder(logRotator(numToKeepStr: '5')) // Garde seulement les 5 derniers builds
    }
    stages {
        stage('Build') {
            steps {
                echo "Ex√©cution du pipeline..."
            }
        }
    }
}
   ```
> Cette option pr√©sente bien d'autres options
``` groovy
options {
    buildDiscarder(logRotator(
        numToKeepStr: '5',         // Garde les 5 derniers builds
        daysToKeepStr: '10',       // Supprime les builds apr√®s 10 jours
        artifactNumToKeepStr: '2', // Garde les artefacts des 2 derniers builds
        artifactDaysToKeepStr: '5' // Supprime les artefacts plus vieux que 5 jours
    ))
}
```

### 3. **`quietPeriod()`**
   D√©finit une p√©riode d'attente avant que Jenkins n'ex√©cute un build apr√®s un d√©clencheur. Cela peut √™tre utile pour √©viter plusieurs ex√©cutions de build cons√©cutives en peu de temps.

   ```groovy
  pipeline {
    agent any
    options {
        quietPeriod(5)  // Attend 5 secondes avant d'ex√©cuter le pipeline
    }
    stages {
        stage('Start') {
            steps {
                echo "Pipeline d√©marr√© apr√®s une pause de 5 secondes."
            }
        }
    }
}
   ```

   Cela indique √† Jenkins d'attendre 5 secondes avant de commencer un build apr√®s qu'un d√©clencheur ait √©t√© activ√©.

   > A ne pas confondre avec `sleep` qui permet de stopper le flux d'execution pour x temps
``` groovy
pipeline {
    agent any
    options {
        quietPeriod(5) // Attendre 5 secondes avant le premier lancement
    }
    stages {
        stage('Test Retry avec Pause') {
            steps {
                script {
                    retry(3) { // R√©essaie jusqu'√† 3 fois en cas d'√©chec
                        echo "Tentative en cours..."
                        def result = sh(script: "exit 1", returnStatus: true) // Simule un √©chec

                        if (result != 0) {
                            echo "√âchec d√©tect√©, attente avant retry..."
                            sleep(5) // Simule un "quietPeriod" avant de r√©essayer
                            error("Nouvelle tentative apr√®s d√©lai...")
                        }
                    }
                }
            }
        }
        stage('Success') {
            steps {
                echo "Pipeline r√©ussi apr√®s retry !"
            }
        }
    }
}

```


### 4. **`skipStagesAfterUnstable`**
   Permet de d√©finir des r√®gles de conformit√© pour le pipeline.

   ```groovy
   pipeline {
    agent any
    options {
        // Simulons une v√©rification de conformit√© personnalis√©e
        skipStagesAfterUnstable() // Une vraie option utile en conformit√©
    }
    stages {
        stage('Compliance Check') {
            steps {
                script {
                    def result = sh(script: '''
                        for file in $(find . -type f -name "*.java"); do
                            if ! grep -q "Copyright MyCompany" "$file"; then
                                echo "Non-compliant file: $file"
                                exit 1
                            fi
                        done
                    ''', returnStatus: true)
                    
                    if (result != 0) {
                        error("Compliance check failed: Some files are missing the required license header.")
                    }
                }
            }
        }
        stage('Build') {
            steps {
                echo 'Building the application...'
            }
        }
    }
}
   ```

### 5. **`retry`**
   Bien que nous l'ayons vu dans l'exemple pr√©c√©dent, cette option permet de sp√©cifier un nombre d'essais suppl√©mentaires pour une √©tape en cas d'√©chec.

   ```groovy
   options {
       retry(2)
   }
   ```

### 6. **`timestamps`**
   Ajoute un horodatage √† chaque ligne de sortie dans le log du pipeline, pour suivre plus facilement l'√©volution du processus.

   ```groovy
   options {
       timestamps()
   }
   ```

L'option **`timestamps()`** dans un pipeline Jenkins sert √† ajouter des horodatages √† chaque ligne des logs de la console.  

### Exemple :  
Sans `timestamps()`, la sortie de la console ressemblera √† ceci :  
```
[Pipeline] echo
Hello, Jenkins!
```
Avec `timestamps()`, elle ressemblera √† ceci :  
```
[2025-02-19 14:30:12] [Pipeline] echo
[2025-02-19 14:30:12] Hello, Jenkins!
```
### Utilit√© :
- Facilite le **debugging** en sachant exactement quand chaque √©tape s'est ex√©cut√©e.
- Utile pour **mesurer les performances** d'un pipeline en observant les dur√©es entre les √©tapes.
- Permet de **tracer l‚Äôex√©cution** dans des environnements o√π les logs sont longs ou analys√©s automatiquement.  

